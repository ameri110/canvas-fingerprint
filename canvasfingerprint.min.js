function PngToy(t){this.doCRC=!0,this.allowInvalid=!1,this.beforeSend=function t(){},Object.assign(this,t),this.url=null,this.buffer=null,this.view=null,this.chunks=[],this.debug={}}/*! canvas_fingerprint */ function get_canvas_fingerprint(){let t={};var e,n,r,i=!0,o=!1,s=!1,a=!1,u="MyCanvasFingerPrint,!$ <canvas> 1.0",_=document.createElement("iframe");if(_.id="canvas-iframe",_.setAttribute("sandbox","allow-same-origin"),_.style.visibility="hidden",_.style.width="0",_.style.height="0",document.body.appendChild(_),($=document.querySelector("#canvas-iframe").contentDocument.createElement("canvas")).getContext&&(e=$.getContext("2d"))){if(o=!0,"function"==typeof $.getContext("2d").fillText){s=!0;try{$.setAttribute("width",220),$.setAttribute("height",30),e.textBaseline="top",e.font="14px 'Arial'",e.textBaseline="alphabetic",e.fillStyle="#f60",e.fillRect(125,1,62,20),e.fillStyle="#069",e.fillText(u,2,15),e.fillStyle="rgba(102, 204, 0, 0.7)",e.fillText(u,4,17)}catch(h){void 0===(e=($=document.createElement("canvas")).getContext("2d"))||"function"!=typeof $.getContext("2d").fillText?(o=!1,s=!1,i=!1):($.setAttribute("width",220),$.setAttribute("height",30),e.textBaseline="top",e.font="14px 'Arial'",e.textBaseline="alphabetic",e.fillStyle="#f60",e.fillRect(125,1,62,20),e.fillStyle="#069",e.fillText(u,2,15),e.fillStyle="rgba(102, 204, 0, 0.7)",e.fillText(u,4,17))}}else i=!1;if(i&&"function"==typeof $.toDataURL){try{if("boolean"==typeof(n=$.toDataURL("image/png"))||void 0===n)throw 1}catch(f){n=""}0===n.indexOf("data:image/png")?a=!0:i=!1}else i=!1}else i=!1;t.canvas_support_2d=o,t.canvas_support_text=s,t.canvas_support_todataurl=a;var u=e,l=n,$=function(){var t=atob(l.split(",")[1]),e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(),o=md5($),c=(t.canvas_fingerprint=o,r=o,0);try{for(var g=u.getImageData(0,0,220,30),d=new Uint32Array(g.data.buffer),p=d.length,y={},v=0;v<p;v++){var T=""+(16777215&d[v]);y[T]||(c++,y[T]=0),y[T]++}}catch(k){}return c<1&&(c="n/a"),t.canvas_file_colors=c,t.canvas_file_size=$.length,new PngToy([{doCRC:!0}]),_&&_.parentNode.removeChild(_),t}!function(){"use strict";function t(t){if(t)d[0]=d[16]=d[1]=d[2]=d[3]=d[4]=d[5]=d[6]=d[7]=d[8]=d[9]=d[10]=d[11]=d[12]=d[13]=d[14]=d[15]=0,this.blocks=d,this.buffer8=a;else if(h){var e=new ArrayBuffer(68);this.buffer8=new Uint8Array(e),this.blocks=new Uint32Array(e)}else this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];this.h0=this.h1=this.h2=this.h3=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}function e(e,n){var r,i=T(e);if(e=i[0],i[1]){var o,s=[],a=e.length,u=0;for(r=0;r<a;++r)(o=e.charCodeAt(r))<128?s[u++]=o:o<2048?(s[u++]=192|o>>>6,s[u++]=128|63&o):o<55296||o>=57344?(s[u++]=224|o>>>12,s[u++]=128|o>>>6&63,s[u++]=128|63&o):(o=65536+((1023&o)<<10|1023&e.charCodeAt(++r)),s[u++]=240|o>>>18,s[u++]=128|o>>>12&63,s[u++]=128|o>>>6&63,s[u++]=128|63&o);e=s}e.length>64&&(e=new t(!0).update(e).array());var _=[],h=[];for(r=0;r<64;++r){var f=e[r]||0;_[r]=92^f,h[r]=54^f}t.call(this,n),this.update(h),this.oKeyPad=_,this.inner=!0,this.sharedMemory=n}var n="input is invalid type",r="object"==typeof window,i=r?window:{};i.JS_MD5_NO_WINDOW&&(r=!1);var o=!r&&"object"==typeof self,s=!i.JS_MD5_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;s?i=global:o&&(i=self);var a,u=!i.JS_MD5_NO_COMMON_JS&&"object"==typeof module&&module.exports,_="function"==typeof define&&define.amd,h=!i.JS_MD5_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,f="0123456789abcdef".split(""),l=[128,32768,8388608,-2147483648],$=[0,8,16,24],c=["hex","array","digest","buffer","arrayBuffer","base64"],g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),d=[];if(h){var p=new ArrayBuffer(68);a=new Uint8Array(p),d=new Uint32Array(p)}var y=Array.isArray;!i.JS_MD5_NO_NODE_JS&&y||(y=function(t){return"[object Array]"===Object.prototype.toString.call(t)});var v=ArrayBuffer.isView;h&&(i.JS_MD5_NO_ARRAY_BUFFER_IS_VIEW||!v)&&(v=function(t){return"object"==typeof t&&t.buffer&&t.buffer.constructor===ArrayBuffer});var T=function(t){var e=typeof t;if("string"===e)return[t,!0];if("object"!==e||null===t)throw Error(n);if(h&&t.constructor===ArrayBuffer)return[new Uint8Array(t),!1];if(!y(t)&&!v(t))throw Error(n);return[t,!1]},k=function(e){return function(n){return new t(!0).update(n)[e]()}},I=function(t){var e,r=require("crypto"),o=require("buffer").Buffer;return e=o.from&&!i.JS_MD5_NO_BUFFER_FROM?o.from:function(t){return new o(t)},function(i){if("string"==typeof i)return r.createHash("md5").update(i,"utf8").digest("hex");if(null==i)throw Error(n);return i.constructor===ArrayBuffer&&(i=new Uint8Array(i)),y(i)||v(i)||i.constructor===o?r.createHash("md5").update(e(i)).digest("hex"):t(i)}},P=function(t){return function(n,r){return new e(n,!0).update(r)[t]()}};t.prototype.update=function(t){if(this.finalized)throw Error("finalize already called");var e=T(t);t=e[0];for(var n,r,i=e[1],o=0,s=t.length,a=this.blocks,u=this.buffer8;o<s;){if(this.hashed&&(this.hashed=!1,a[0]=a[16],a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),i){if(h)for(r=this.start;o<s&&r<64;++o)(n=t.charCodeAt(o))<128?u[r++]=n:n<2048?(u[r++]=192|n>>>6,u[r++]=128|63&n):n<55296||n>=57344?(u[r++]=224|n>>>12,u[r++]=128|n>>>6&63,u[r++]=128|63&n):(n=65536+((1023&n)<<10|1023&t.charCodeAt(++o)),u[r++]=240|n>>>18,u[r++]=128|n>>>12&63,u[r++]=128|n>>>6&63,u[r++]=128|63&n);else for(r=this.start;o<s&&r<64;++o)(n=t.charCodeAt(o))<128?a[r>>>2]|=n<<$[3&r++]:n<2048?(a[r>>>2]|=(192|n>>>6)<<$[3&r++],a[r>>>2]|=(128|63&n)<<$[3&r++]):n<55296||n>=57344?(a[r>>>2]|=(224|n>>>12)<<$[3&r++],a[r>>>2]|=(128|n>>>6&63)<<$[3&r++],a[r>>>2]|=(128|63&n)<<$[3&r++]):(n=65536+((1023&n)<<10|1023&t.charCodeAt(++o)),a[r>>>2]|=(240|n>>>18)<<$[3&r++],a[r>>>2]|=(128|n>>>12&63)<<$[3&r++],a[r>>>2]|=(128|n>>>6&63)<<$[3&r++],a[r>>>2]|=(128|63&n)<<$[3&r++])}else if(h)for(r=this.start;o<s&&r<64;++o)u[r++]=t[o];else for(r=this.start;o<s&&r<64;++o)a[r>>>2]|=t[o]<<$[3&r++];this.lastByteIndex=r,this.bytes+=r-this.start,r>=64?(this.start=r-64,this.hash(),this.hashed=!0):this.start=r}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this},t.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var t=this.blocks,e=this.lastByteIndex;t[e>>>2]|=l[3&e],e>=56&&(this.hashed||this.hash(),t[0]=t[16],t[16]=t[1]=t[2]=t[3]=t[4]=t[5]=t[6]=t[7]=t[8]=t[9]=t[10]=t[11]=t[12]=t[13]=t[14]=t[15]=0),t[14]=this.bytes<<3,t[15]=this.hBytes<<3|this.bytes>>>29,this.hash()}},t.prototype.hash=function(){var t,e,n,r,i,o,s=this.blocks;this.first?e=((e=((t=((t=s[0]-680876937)<<7|t>>>25)-271733879<<0)^(n=((n=(-271733879^(r=((r=(-1732584194^2004318071&t)+s[1]-117830708)<<12|r>>>20)+t<<0)&(-271733879^t))+s[2]-1126478375)<<17|n>>>15)+r<<0)&(r^t))+s[3]-1316259209)<<22|e>>>10)+n<<0:(t=this.h0,e=this.h1,n=this.h2,e=((e+=((t=((t+=((r=this.h3)^e&(n^r))+s[0]-680876936)<<7|t>>>25)+e<<0)^(n=((n+=(e^(r=((r+=(n^t&(e^n))+s[1]-389564586)<<12|r>>>20)+t<<0)&(t^e))+s[2]+606105819)<<17|n>>>15)+r<<0)&(r^t))+s[3]-1044525330)<<22|e>>>10)+n<<0),e=((e+=((t=((t+=(r^e&(n^r))+s[4]-176418897)<<7|t>>>25)+e<<0)^(n=((n+=(e^(r=((r+=(n^t&(e^n))+s[5]+1200080426)<<12|r>>>20)+t<<0)&(t^e))+s[6]-1473231341)<<17|n>>>15)+r<<0)&(r^t))+s[7]-45705983)<<22|e>>>10)+n<<0,e=((e+=((t=((t+=(r^e&(n^r))+s[8]+1770035416)<<7|t>>>25)+e<<0)^(n=((n+=(e^(r=((r+=(n^t&(e^n))+s[9]-1958414417)<<12|r>>>20)+t<<0)&(t^e))+s[10]-42063)<<17|n>>>15)+r<<0)&(r^t))+s[11]-1990404162)<<22|e>>>10)+n<<0,e=((e+=((t=((t+=(r^e&(n^r))+s[12]+1804603682)<<7|t>>>25)+e<<0)^(n=((n+=(e^(r=((r+=(n^t&(e^n))+s[13]-40341101)<<12|r>>>20)+t<<0)&(t^e))+s[14]-1502002290)<<17|n>>>15)+r<<0)&(r^t))+s[15]+1236535329)<<22|e>>>10)+n<<0,e=((e+=((r=((r+=(e^n&((t=((t+=(n^r&(e^n))+s[1]-165796510)<<5|t>>>27)+e<<0)^e))+s[6]-1069501632)<<9|r>>>23)+t<<0)^t&((n=((n+=(t^e&(r^t))+s[11]+643717713)<<14|n>>>18)+r<<0)^r))+s[0]-373897302)<<20|e>>>12)+n<<0,e=((e+=((r=((r+=(e^n&((t=((t+=(n^r&(e^n))+s[5]-701558691)<<5|t>>>27)+e<<0)^e))+s[10]+38016083)<<9|r>>>23)+t<<0)^t&((n=((n+=(t^e&(r^t))+s[15]-660478335)<<14|n>>>18)+r<<0)^r))+s[4]-405537848)<<20|e>>>12)+n<<0,e=((e+=((r=((r+=(e^n&((t=((t+=(n^r&(e^n))+s[9]+568446438)<<5|t>>>27)+e<<0)^e))+s[14]-1019803690)<<9|r>>>23)+t<<0)^t&((n=((n+=(t^e&(r^t))+s[3]-187363961)<<14|n>>>18)+r<<0)^r))+s[8]+1163531501)<<20|e>>>12)+n<<0,e=((e+=((r=((r+=(e^n&((t=((t+=(n^r&(e^n))+s[13]-1444681467)<<5|t>>>27)+e<<0)^e))+s[2]-51403784)<<9|r>>>23)+t<<0)^t&((n=((n+=(t^e&(r^t))+s[7]+1735328473)<<14|n>>>18)+r<<0)^r))+s[12]-1926607734)<<20|e>>>12)+n<<0,e=((e+=((o=(r=((r+=((i=e^n)^(t=((t+=(i^r)+s[5]-378558)<<4|t>>>28)+e<<0))+s[8]-2022574463)<<11|r>>>21)+t<<0)^t)^(n=((n+=(o^e)+s[11]+1839030562)<<16|n>>>16)+r<<0))+s[14]-35309556)<<23|e>>>9)+n<<0,e=((e+=((o=(r=((r+=((i=e^n)^(t=((t+=(i^r)+s[1]-1530992060)<<4|t>>>28)+e<<0))+s[4]+1272893353)<<11|r>>>21)+t<<0)^t)^(n=((n+=(o^e)+s[7]-155497632)<<16|n>>>16)+r<<0))+s[10]-1094730640)<<23|e>>>9)+n<<0,e=((e+=((o=(r=((r+=((i=e^n)^(t=((t+=(i^r)+s[13]+681279174)<<4|t>>>28)+e<<0))+s[0]-358537222)<<11|r>>>21)+t<<0)^t)^(n=((n+=(o^e)+s[3]-722521979)<<16|n>>>16)+r<<0))+s[6]+76029189)<<23|e>>>9)+n<<0,e=((e+=((o=(r=((r+=((i=e^n)^(t=((t+=(i^r)+s[9]-640364487)<<4|t>>>28)+e<<0))+s[12]-421815835)<<11|r>>>21)+t<<0)^t)^(n=((n+=(o^e)+s[15]+530742520)<<16|n>>>16)+r<<0))+s[2]-995338651)<<23|e>>>9)+n<<0,e=((e+=((r=((r+=(e^((t=((t+=(n^(e|~r))+s[0]-198630844)<<6|t>>>26)+e<<0)|~n))+s[7]+1126891415)<<10|r>>>22)+t<<0)^((n=((n+=(t^(r|~e))+s[14]-1416354905)<<15|n>>>17)+r<<0)|~t))+s[5]-57434055)<<21|e>>>11)+n<<0,e=((e+=((r=((r+=(e^((t=((t+=(n^(e|~r))+s[12]+1700485571)<<6|t>>>26)+e<<0)|~n))+s[3]-1894986606)<<10|r>>>22)+t<<0)^((n=((n+=(t^(r|~e))+s[10]-1051523)<<15|n>>>17)+r<<0)|~t))+s[1]-2054922799)<<21|e>>>11)+n<<0,e=((e+=((r=((r+=(e^((t=((t+=(n^(e|~r))+s[8]+1873313359)<<6|t>>>26)+e<<0)|~n))+s[15]-30611744)<<10|r>>>22)+t<<0)^((n=((n+=(t^(r|~e))+s[6]-1560198380)<<15|n>>>17)+r<<0)|~t))+s[13]+1309151649)<<21|e>>>11)+n<<0,e=((e+=((r=((r+=(e^((t=((t+=(n^(e|~r))+s[4]-145523070)<<6|t>>>26)+e<<0)|~n))+s[11]-1120210379)<<10|r>>>22)+t<<0)^((n=((n+=(t^(r|~e))+s[2]+718787259)<<15|n>>>17)+r<<0)|~t))+s[9]-343485551)<<21|e>>>11)+n<<0,this.first?(this.h0=t+1732584193<<0,this.h1=e-271733879<<0,this.h2=n-1732584194<<0,this.h3=r+271733878<<0,this.first=!1):(this.h0=this.h0+t<<0,this.h1=this.h1+e<<0,this.h2=this.h2+n<<0,this.h3=this.h3+r<<0)},t.prototype.hex=function(){this.finalize();var t=this.h0,e=this.h1,n=this.h2,r=this.h3;return f[t>>>4&15]+f[15&t]+f[t>>>12&15]+f[t>>>8&15]+f[t>>>20&15]+f[t>>>16&15]+f[t>>>28&15]+f[t>>>24&15]+f[e>>>4&15]+f[15&e]+f[e>>>12&15]+f[e>>>8&15]+f[e>>>20&15]+f[e>>>16&15]+f[e>>>28&15]+f[e>>>24&15]+f[n>>>4&15]+f[15&n]+f[n>>>12&15]+f[n>>>8&15]+f[n>>>20&15]+f[n>>>16&15]+f[n>>>28&15]+f[n>>>24&15]+f[r>>>4&15]+f[15&r]+f[r>>>12&15]+f[r>>>8&15]+f[r>>>20&15]+f[r>>>16&15]+f[r>>>28&15]+f[r>>>24&15]},t.prototype.toString=t.prototype.hex,t.prototype.digest=function(){this.finalize();var t=this.h0,e=this.h1,n=this.h2,r=this.h3;return[255&t,t>>>8&255,t>>>16&255,t>>>24&255,255&e,e>>>8&255,e>>>16&255,e>>>24&255,255&n,n>>>8&255,n>>>16&255,n>>>24&255,255&r,r>>>8&255,r>>>16&255,r>>>24&255]},t.prototype.array=t.prototype.digest,t.prototype.arrayBuffer=function(){this.finalize();var t=new ArrayBuffer(16),e=new Uint32Array(t);return e[0]=this.h0,e[1]=this.h1,e[2]=this.h2,e[3]=this.h3,t},t.prototype.buffer=t.prototype.arrayBuffer,t.prototype.base64=function(){for(var t,e,n,r="",i=this.array(),o=0;o<15;)t=i[o++],e=i[o++],n=i[o++],r+=g[t>>>2]+g[63&(t<<4|e>>>4)]+g[63&(e<<2|n>>>6)]+g[63&n];return r+(g[(t=i[o])>>>2]+g[t<<4&63]+"==")},(e.prototype=new t).finalize=function(){if(t.prototype.finalize.call(this),this.inner){this.inner=!1;var e=this.array();t.call(this,this.sharedMemory),this.update(this.oKeyPad),this.update(e),t.prototype.finalize.call(this)}};var w=function(){var e=k("hex");s&&(e=I(e)),e.create=function(){return new t},e.update=function(t){return e.create().update(t)};for(var n=0;n<c.length;++n){var r=c[n];e[r]=k(r)}return e}();w.md5=w,w.md5.hmac=function(){var t=P("hex");t.create=function(t){return new e(t)},t.update=function(e,n){return t.create(e).update(n)};for(var n=0;n<c.length;++n){var r=c[n];t[r]=P(r)}return t}(),u?module.exports=w:(i.md5=w,_&&define(function(){return w}))}(),PngToy.prototype={fetch:function(t){var e=this;return e.url=t,e.buffer=e.chunks=e.view=null,e._pos=0,new Promise(function(n,r){if("string"==typeof t)try{var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",e.beforeSend(i),i.onerror=function(t){r("Network error. "+t.message)},i.onload=function(){200===i.status?s(i.response):r("Loading error:"+i.statusText)},i.send()}catch(o){r(o.message)}else s(ArrayBuffer.isView(t)?t.buffer:t);function s(t){var i,o;try{i=new DataView(t),t.byteLength>66&&2303741511===i.getUint32(0)&&218765834===i.getUint32(4)?(o=PngToy._getChunks(t,i,e.doCRC,e.allowInvalid),e.buffer=t,e.view=i,e.chunks=o.chunks||[],e.chunks||e.allowInvalid?n():r(o.error)):r("Not a PNG file.")}catch(s){r(s.message)}}})},getChunk:function(t){return["IHDR","IDAT","PLTE","sPLT","tRNS","iTXt","tEXt","zTXt","iCCP","gAMA","cHRM","sRGB","hIST","sBIT","pHYs","bKGD","tIME","oFFs","sTER","sCAL","pCAL","IEND"].indexOf(t)>-1?"IEND"===t?!!PngToy._findChunk(this.chunks,"IEND"):PngToy["_"+t](this):PngToy._findChunk(this.chunks,t)},toMinimal:function(t){if(this.chunks.length){var e=["IHDR","IDAT","IEND","PLTE","tRNS","gAMA"],n=[new Uint32Array([1196314761,169478669])];return this.chunks.forEach(function(t){e.indexOf(t.name)>-1&&n.push(t.getRaw(!0))}),new Blob(n,{type:t?"application/octet-stream":"image/png"})}throw"No file loaded (see fetch())."},getGammaLUT:function(t,e,n){for(var r=new Uint8Array(256),i=1/((t||1)*(e||2.2)*(n||1)),o=0;o<256;o++)r[o]=Math.round(255*Math.pow(o/255,i));return r},guessDisplayGamma:function(){return navigator.userAgent.indexOf("Mac OS")>-1?1.8:2.2}},PngToy._blockSize=2097152,PngToy._delay=7,"undefined"!=typeof exports&&(exports.PngToy=PngToy),PngToy._getChunks=function(t,e,n,r){var i,o,s,a,u,_,h,f,l,$,c,g=this,d=8,p=t.byteLength,y=[],v=!0,T=["iTXT","tIME","tEXt","zTXt"],k=PngToy._findChunk,I="Invalid number of ",P="Invalid chunk order for ";if(n&&!this.table){this.table=new Uint32Array(256);for(var w,b=0;b<256;b++){for(w=0,u=b>>>0;w<8;w++)u=1&u?3988292384^u>>>1:u>>>1;this.table[b]=u}}for(;d<p;){if(o=E(),s=A(),o>2147483647&&!r)return{error:"Invalid chunk size."};if(d=(a=d)+o,u=E(),i=new PngToy.Chunk(s,a,o,u,t),n&&(x(i),!i.crcOk&&!r))return{error:"Invalid CRC in chunk "+s};if(i.isReserved&&!r)return{error:"Invalid chunk name: "+s};y.push(i)}if(!r){if(!m("IHDR",1,1))return{error:I+"IHDR chunks."};if(!m("tIME",0,1))return{error:I+"tIME chunks."};if(!m("zTXt",0,-1))return{error:I+"zTXt chunks."};if(!m("tEXt",0,-1))return{error:I+"tEXt chunks."};if(!m("iTXt",0,-1))return{error:I+"iTXt chunks."};if(!m("pHYs",0,1))return{error:I+"pHYs chunks."};if(!m("sPLT",0,-1))return{error:I+"sPLT chunks."};if(!m("iCCP",0,1))return{error:I+"iCCP chunks."};if(!m("sRGB",0,1))return{error:I+"sRGB chunks."};if(!m("sBIT",0,1))return{error:I+"sBIT chunks."};if(!m("gAMA",0,1))return{error:I+"gAMA chunks."};if(!m("cHRM",0,1))return{error:I+"cHRM chunks."};if(!m("PLTE",0,1))return{error:I+"PLTE chunks."};if(!m("tRNS",0,1))return{error:I+"tRNS chunks."};if(!m("hIST",0,1))return{error:I+"hIST chunks."};if(!m("bKGD",0,1))return{error:I+"bKGD chunks."};if(!m("IDAT",1,-1))return{error:I+"IDAT chunks."};if(!m("IEND",1,1))return{error:I+"IEND chunks."};if("IHDR"!==y[0].name||"IEND"!==y[y.length-1].name)return{error:"Invalid PNG chunk order."};if(_=e.getUint8(k(y,"IHDR").offset+9),h=k(y,"PLTE"),l=k(y,"hIST"),f=k(y,"tRNS"),$=k(y,"oFFs"),c=k(y,"sTER"),k(y,"iCCP")&&k(y,"sRGB"))return{error:"Both iCCP and sRGB cannot be present."};if(3===_&&!h)return{error:"Missing PLTE chunk."};if((0===_||4===_)&&h)return{error:"PLTE chunk should not appear with this color type."};if((4===_||6===_)&&f)return{error:"tRNS chunk should not appear with this color type."};if(l&&!h)return{error:"hIST chunk can only appear if a PLTE chunk is present."};if(h){if(!R("PLTE","IDAT"))return{error:P+"PLTE."};if(l&&!C("PLTE","hIST","IDAT"))return{error:P+"hIST."};if(f&&!C("PLTE","tRNS","IDAT"))return{error:P+"tRNS."};if(k(y,"bKGD")&&!C("PLTE","bKGD","IDAT"))return{error:P+"bKGD."};if(!R("cHRM","PLTE"))return{error:P+"cHRM."};if(!R("gAMA","PLTE"))return{error:P+"gAMA."};if(!R("iCCP","PLTE"))return{error:P+"iCCP."};if(!R("sRGB","PLTE"))return{error:P+"sRGB."}}if($&&!R("oFFs","IDAT"))return{error:P+"oFFs."};if(c&&!R("sTER","IDAT"))return{error:P+"sTER."};for(b=y.length-2;b>0;b--)if(v&&"IDAT"!==y[b].name&&0>T.indexOf(y[b].name))v=!1;else if(!v&&"IDAT"===y[b].name)return{error:"Invalid chunk inside IDAT chunk sequence."}}return{chunks:y};function m(t,e,n){var r=PngToy._findChunks(y,t);return n<0?r.length>=e:r.length>=e&&r.length<=n}function C(t,e,n){return R(t,e)&&R(e,n)}function R(t,e){var n,r=-1,i=-1,o=y.length;for(n=0;n<o;n++)y[n].name===t&&(r=n),y[n].name===e&&(i=n);return r<i}function x(e){var n=new Uint8Array(t,e.offset-4,e.length+4);e.crcOk=e.crc===function t(e){var n,r=4294967295,i=e.length;for(n=0;n<i;n++)r=r>>>8^g.table[(r^e[n])&255];return(-1^r)>>>0}(n)}function A(){var t=E(),e=String.fromCharCode;return e(t>>>24)+e(t>>16&255)+e(t>>8&255)+e(255&t)}function E(){var t=e.getUint32(d);return d+=4,t>>>0}},PngToy._getChunks.table=null,PngToy._findChunk=function(t,e){for(var n,r=0;n=t[r++];)if(n.name===e)return n;return null},PngToy._findChunks=function(t,e){var n=[];return t.forEach(function(t){t.name===e&&n.push(t)}),n},PngToy._getStr=function(t,e,n){var r,i="",o=e,s=-1,a=!1,u=String.fromCharCode;for(n+=o;o<n&&s;){if(s=t.getUint8(o++)){r=u(s)," abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!\"%&'()*+,-./:;<=>?_".indexOf(r)>-1?i+=r:a=!0;continue}break}return{offset:o,text:i,warning:a}},PngToy.Chunk=function(t,e,n,r,i){this.name=t,this.offset=e,this.length=n,this.crc=r,this.crcOk=!0,this.isCritical=!(32&t.charCodeAt(0)),this.isPrivate=!!(32&t.charCodeAt(1)),this.isReserved=!!(32&t.charCodeAt(2)),this.isCopySafe=!!(32&t.charCodeAt(3)),this.buffer=i},PngToy.Chunk.prototype={getRaw:function(t){return t?new Uint8Array(this.buffer,this.offset-8,this.length+12):new Uint8Array(this.buffer,this.offset,this.length)}},PngToy._bKGD=function(t){var e=t.view,n=t.chunks,r=PngToy._findChunk(n,"bKGD"),i=PngToy._IHDR(t);if(!r)return null;switch(i.type){case 0:case 4:return{background:[e.getUint16(r.offset)]};case 2:case 6:return{background:new Uint16Array(e.buffer,r.offset,6)};default:return{index:e.getUint8(r.offset)}}},PngToy._cHRM=function(t){var e,n,r=t.view,i=t.chunks,o=(t.allowInvalid,PngToy._findChunk(i,"cHRM"));return o?(n=o.offset,e={whiteX:r.getUint32(n)/1e5,whiteY:r.getUint32(n+4)/1e5,redX:r.getUint32(n+8)/1e5,redY:r.getUint32(n+12)/1e5,greenX:r.getUint32(n+16)/1e5,greenY:r.getUint32(n+20)/1e5,blueX:r.getUint32(n+24)/1e5,blueY:r.getUint32(n+28)/1e5}):null},PngToy._oFFs=function(t){var e,n=t.view,r=t.chunks,i=t.allowInvalid,o=PngToy._findChunk(r,"oFFs"),s={};return o?(e=o.offset,s.x=n.getInt32(e),s.y=n.getInt32(e+4),s.unit=n.getUint8(e+8),s.desc=["Pixels","Micrometers"][s.unit]||"Invalid",!i&&(s.unit<0||s.unit>1))?{error:"Invalid unit for oFFs chunk."}:s:null},PngToy._pCAL=function(t){var e,n,r,i=t.view,o=t.chunks,s=t.allowInvalid,a=PngToy._findChunk(o,"pCAL"),u=!1,_={},h=[],f=0;if(!a.length)return null;for(e=a.offset,n=PngToy._getStr(i,e,80),_.calName=n.text,e=n.offset,n.warn&&(u=!0),_.x0=i.getInt32(e),_.x1=i.getInt32(e+4),_.eqType=i.getUint8(e+8),_.eqDesc=["Linear mapping","Base-e exponential mapping","Arbitrary-base exponential mapping","Hyperbolic mapping"][_.eqType]||null,_.paramCount=i.getUint8(e+9),e+=10,n=PngToy._getStr(i,e,1e4),_.unitName=n.text,e=n.offset,n.warn&&(u=!0),r=_.paramCount-1;f<r;f++)n=PngToy._getStr(i,e,1e4),h.push(n.text),e=n.offset,n.warn&&(u=!0);if(n=PngToy._getStr(i,e,a.length-(e-a.offset)),h.push(n.text),n.warn&&(u=!0),_.parameters=h,!s){if(_.x0===_.x1)return{error:"Invalid x0 or x1."};if(h.length!==_.paramCount)return{error:"Mismatching parameter count and number of parameters."};if(_.eqType<0||_.eqType>3)return{error:"Invalid equation type."};if(u)return{error:"One or more text field contains illegal chars."}}return _},PngToy._sCAL=function(t){var e,n,r=t.view,i=t.chunks,o=t.allowInvalid,s=PngToy._findChunk(i,"sCAL"),a={};return s.length?(e=s.offset,a.unit=r.getUint8(e++),a.desc=["meters","radians"][a.unit]||null,n=PngToy._getStr(r,e,1e5),a.unitsX=n.text,e=n.offset,n=PngToy._getStr(r,e,s.length-(e-s.offset)),a.unitsY=n.text,!o&&(a.unit<1||a.unit>2))?{error:"Invalid unit"}:a:null},PngToy._sTER=function(t){var e,n=t.view,r=t.chunks,i=t.allowInvalid,o=PngToy._findChunk(r,"sTER"),s={};return o?(e=o.offset,s.mode=n.getUint8(e),s.desc=["Cross-fuse layout","Diverging-fuse layout"][s.mode],!i&&(s.mode<0||s.mode>1))?{error:"Invalid mode for sTER chunk."}:s:null},PngToy._gAMA=function(t){var e,n=t.view,r=t.chunks,i=(t.allowInvalid,PngToy._findChunk(r,"gAMA"));return i?{gamma:e=n.getUint32(i.offset)/1e5}:null},PngToy._hIST=function(t){var e,n,r=t.view,i=t.chunks,o=t.allowInvalid,s=PngToy._findChunk(i,"hIST"),a=PngToy._PLTE(t),u=[];if(!s)return null;if(!o&&s.length%2)return{error:"Invalid length of hIST chunk."};for(n=(e=s.offset)+s.length;e<n;e+=2)u.push(r.getUint16(e));return o||u.length===a.length?{histogram:u}:{error:"hIST chunk must have same number of entries as PLTE chunk."}},PngToy._IHDR=function(t){var e,n,r=t.view,i=t.chunks,o=t.allowInvalid,s=PngToy._findChunk(i,"IHDR");if(!s)return{error:"Critical - IHDR chunk is missing."};if(e=s.offset,n={width:r.getUint32(e),height:r.getUint32(e+4),depth:r.getUint8(e+8),type:r.getUint8(e+9),compression:r.getUint8(e+10),filter:r.getUint8(e+11),interlaced:r.getUint8(e+12)},!o){if(0>[0,2,3,4,6].indexOf(n.type))return{error:"Invalid color type."};switch(n.type){case 0:if(0>[1,2,4,8,16].indexOf(n.depth))return{error:"Invalid color depth."};break;case 3:if(0>[1,2,4,8].indexOf(n.depth))return{error:"Invalid color depth."};break;default:if(0>[8,16].indexOf(n.depth))return{error:"Invalid color depth."}}if(!n.width||!n.height)return{error:"Invalid dimension."};if(n.compression)return{error:"Invalid compression type."};if(n.filter)return{error:"Invalid filter type."};if(n.interlaced<0||n.interlaced>1)return{error:"Invalid interlace mode "+n.interlaced}}return n},PngToy._pHYs=function(t){var e,n=t.view,r=t.chunks,i=t.allowInvalid,o=PngToy._findChunk(r,"pHYs"),s={};if(!o)return null;if(e=o.offset,s.ppuX=n.getUint32(e),s.ppuY=n.getUint32(e+4),s.unit=n.getUint8(e+8),1===s.unit?s.desc="Meters":s.desc="ratio",i)s.ppuX&=2147483647,s.ppuY&=2147483647,s.unit&=1;else{if(s.ppuX>2147483647||s.ppuY>2147483647)return{error:"Invalid unit lengths."};if(s.unit<0||s.unit>1)return{error:"Invalid unit for pHYs chunk."}}return s},PngToy._PLTE=function(t){var e,n=t.buffer,r=t.chunks,i=t.allowInvalid,o=PngToy._findChunk(r,"PLTE");if(!o)return null;if(e=new Uint8Array(n,o.offset,o.length),!i){if(e.length%3)return{error:"Invalid palette size."};if(e.length<3||e.length>768)return{error:"Invalid number of palette entries."}}return{palette:e,length:e.length/3}},PngToy._sBIT=function(t){var e,n,r=t.view,i=t.chunks,o=t.allowInvalid,s=PngToy._findChunk(i,"sBIT"),a=PngToy._IHDR(t),u=!1,_={grey:null,alpha:null,red:null,green:null,blue:null};if(!s)return null;switch(e=s.offset,n=3===a.type?8:a.depth,a.type){case 0:_.grey=r.getUint8(e);break;case 2:case 3:_.red=r.getUint8(e++),_.green=r.getUint8(e++),_.blue=r.getUint8(e);break;case 4:_.grey=r.getUint8(e++),_.alpha=r.getUint8(e);break;case 6:_.red=r.getUint8(e++),_.green=r.getUint8(e++),_.blue=r.getUint8(e++),_.alpha=r.getUint8(e)}return!o&&(null!==_.red&&(_.red>n||0===_.red)&&(u=!0),null!==_.green&&(_.green>n||0===_.green)&&(u=!0),null!==_.blue&&(_.blue>n||0===_.blue)&&(u=!0),null!==_.grey&&(_.grey>n||0===_.grey)&&(u=!0),null!==_.alpha&&(_.alpha>n||0===_.alpha)&&(u=!0),u)?{error:"Invalid sBIT chunk."}:_},PngToy._sPLT=function(t){var e=t.view,n=t.chunks,r=t.allowInvalid,i=PngToy._findChunks(n,"sPLT"),o=[];return i.length?(i.forEach(function(t){var n,i,s,a,u,_,h,f={depth:null,name:null,palette:[],entries:0},l=[];for(_=0,i=t.offset,n=PngToy._getStr(e,i,80),f.name=n.text,i=n.offset,f.depth=e.getUint8(i++),a=8===f.depth?6:10,u=8===f.depth?1:2,s=t.length-(i-t.offset),h=6===a?e.getUint8.bind(e):e.getUint16.bind(e);_<s;_+=a)l.push(h(i+_),h(i+_+u),h(i+_+2*u),h(i+_+3*u),e.getUint16(i+_+4*u));if(f.palette=l,f.entries=l.length/a,!r&&(8===f.depth&&s%6||16===f.depth&&s%10))return{error:"Invalid sPLT chunk."};o.push(f)}),o):null},PngToy._sRGB=function(t){var e,n=t.view,r=t.chunks,i=t.allowInvalid,o=PngToy._findChunk(r,"sRGB");return o?(e=n.getUint8(o.offset),!i&&(e<0||e>3))?{error:"Invalid range for sRGB render intent."}:{intent:e,desc:["Perceptual","Relative colorimetric","Saturation","Absolute colorimetric"][e]||null}:null},PngToy._tEXt=function(t){var e,n,r,i,o=t.view,s=t.chunks,a=t.allowInvalid,u=PngToy._findChunks(s,"tEXt"),_=!1,h=!1,f=[];return u.length?(u.forEach(function(t){if(!h){var s={};for(e=t.offset,r=PngToy._getStr(o,e,80),s.keyword=r.text,e=r.offset,r.warn&&(_=!0),n=new Uint8Array(o.buffer,e,t.length-(e-t.offset)),r="",i=0;i<n.length;i++)r+=String.fromCharCode(n[i]);if(s.text=r,f.push(s),!a&&_)return h=!0,{error:"One or more field contains illegal chars."}}}),f):null},PngToy._tIME=function(t){var e,n,r=t.view,i=t.chunks,o=t.allowInvalid,s=PngToy._findChunk(i,"tIME");if(!s)return null;if(e=s.offset,n={year:r.getUint16(e),month:r.getUint8(e+2),day:r.getUint8(e+3),hour:r.getUint8(e+4),minute:r.getUint8(e+5),second:r.getUint8(e+6),date:null},!o&&(n.year<0||n.year>65535||n.month<1||n.month>12||n.day<1||n.day>31||n.hour<0||n.hour>23||n.minute<0||n.minute>59||n.second<0||n.second>60))return{error:"Invalid timestamp."};try{n.date=new Date(n.year,n.month-1,n.day,n.hour,n.minute,Math.min(59,n.second))}catch(a){if(!o)return{error:a}}return n},PngToy._tRNS=function(t){var e,n=t.buffer,r=t.chunks,i=t.allowInvalid,o=PngToy._findChunk(r,"tRNS"),s=PngToy._PLTE(t),a=PngToy._IHDR(t);if(!o)return null;if(!i&&2===a.type&&o.length%6)return{error:"Invalid tRNS length."};switch(a.type){case 0:e={alphas:new Uint16Array(n.slice(o.offset,o.offset+o.length)),length:o.length>>1};break;case 2:e={alphas:new Uint16Array(n.slice(o.offset,o.offset+o.length)),length:o.length/6};break;case 3:e={alphas:new Uint8Array(n,o.offset,o.length),length:o.length};break;default:return i?{alphas:null,length:0}:{error:"tRNS chunk is not valid for this color type."}}return!i&&s&&e.length>s.length?{error:"tRNS chunk contains more entries than palette entries."}:e},Object.assign||(Object.assign=function(t,e){for(var n,r=arguments,i=1;i<arguments.length;i++)for(var o in n=Object(r[i]))Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t});
